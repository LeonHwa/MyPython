{% extends '__base__.html' %}
{% block title %}编辑日志{% endblock %}
{% block beforehead %}
 <script src="/static/js/awesome.js"></script>
 <script>
 var
       ID =  '{{ id }}',
       action = '{{ action }}';
 function initVM(blog) {
      var vm = new Vue({
          el:'#vm',
          data:blog,
          methods:{
              submit:function (event) {
                  event.preventDefault();
                  var $form = $('#vm');
                  $form.postJSON(action,this.$data,function (err,r) {
                      if(!err){
                          return location.assign('/api/blogs' + r.id)
                      }else {
                          $('#error').text(err.message);
                          $('.alert').show();
                      }
                  });

              }
          }
      });
     $('vm').show();
 }
 
 $(function () {
    $('.alert').hide();

    if(ID){
        getJSON('api/blogs' + ID,function (err,blog) {
            if(!err){
                initVM(blog);
            }
        })
    } else {
        initVM({
            blogtitle: '',
            blogsummary: '',
            blogcontent: ''
        });
    }
 });
 </script>


{% endblock %}






{% block content %}
<div class="container">
  <div  class="alert alert-danger col-sm-8 col-sm-offset-2" role="alert">
   <p id="error"></p>
  </div>
  <div class="row" >
    <div class="col-sm-8 col-sm-offset-2">
     <div class="from-box">
        <form id="vm" role="form" method="post">
             <div class="form-group">
                 <label class="sr-only" for="blogtitle"></label>
                 <input v-model = "blogtitle" type = "text" class="form-control" placeholder="标题" id="blogtitle"> </input>
             </div>
              <div class="form-group">
                 <label class="sr-only" for="blogsummary"></label>
                 <textarea   v-model = "blogsummary"  class="form-control" placeholder="简介" id="blogsummary" rows="2"> </textarea>
             </div>
             <div class="form-group">
                  <label class="sr-only" for="blogcontent"></label>
                 <textarea  v-model = "blogcontent" class="form-control" placeholder="内容" id="blogcontent" rows="10"> </textarea>
             </div>
             <div  class="form-group">
              <button v-on:click="submit" type="submit" class="btn btn-success" style="margin-top: 20px" >提交</button>
             </div>
        </form>
     </div>
    </div>
  </div>
</div>

{% endblock %}